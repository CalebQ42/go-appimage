dist: xenial
language: go

arch:
  - amd64
  - i386
  - arm64
  - arm32
  
go:
- "1.12"

git:
  depth: 1

script:
  - export GO111MODULE=on # Needed?
  - cd src/appimagetool/
  - go build appimagetool.go
  - strip ./appimagetool
  - ls -lh ./appimagetool
  - ./appimagetool
  - cd -
  - cd src/appimaged/
  - go build
  - strip ./appimaged
  - ls -lh ./appimaged
  # ./appimaged &
  # sleep 10
  # killall appimaged
  - cd -
  - ARCH=$(arch)
  - cp ./src/appimaged/appimaged appimaged-$ARCH

after_success:
  - wget -c https://github.com/probonopd/uploadtool/raw/master/upload.sh
  - bash upload.sh appimaged-*
  
branches:
  except:
    - # Do not build tags that we create when we upload to GitHub Releases
    - /^(?i:continuous)/

cache:
  directories:
    - $HOME/gopath/src
